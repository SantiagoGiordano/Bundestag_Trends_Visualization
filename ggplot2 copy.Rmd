---
title: "Visualizing Trends in the Bundestag"
author: "Santiago Giordano"
date: </br>`r format(Sys.time(), '%d %B %Y')`
output: github_document
---

```{r setup, include=FALSE}
## These next lines set the default behaviour for all R chunks in the .Rmd document.
## I recomend you take a look here: https://rmarkdown.rstudio.com/authoring_rcodechunks.html
knitr::opts_chunk$set(echo = TRUE) ## Show all R output
knitr::opts_chunk$set(cache=TRUE) ## Cache the results to increase performance.
```

# Instructions:

The _nominal_ goal of this assignment is simple: I want you to produce two different figures using **ggplot2**. They don't have to be identify causal relationships, or anything like that. I just want you to stretch your visualization legs and demonstrate any new (or existing) **ggplot2** skills that you have acquired since our first lecture. 

The _actual_ goal of this assignment is to make sure you can connect to GitHub Classroom and submit a solution in a low-stakes environment. We'll move on to the more challenging assignments once everyone has had a chance to familiarize themselves with this setup.


## What you will be graded on

This assignment will only count a small portion (5%) of your final grade. Again, the idea is to provide a low-stakes environment for you to get used to GitHub Classroom and the mode of assignment evaluation that I'll be using for the course. With that being said, here are some things that I will grade you on:

- Are your figures clear? (e.g. lack of chart chunk, non-overlapping labels)
- Are your figures compelling? (e.g. use an appropriate geom for the insight that you want to convey)
- Variation (I don't want to see two line charts of the same dataset... Be creative)
- Did you read and follow my instructions (e.g. describe your data and figures, show the code that produced the figures, include data in the `/data` folder, etc)

Lastly, don't forget to knit the assignment (click the "Knit" button, or press `Ctrl+Shift+K`) before submitting!

# Assignment:


```{r libs, message = FALSE}
if (!require("pacman")) install.packages("pacman")
## Note: The `p_load()` function from the pacman package is a convenient way to 
## install (if necessary) and load packages all at once. You can think of this
## as an alternative to the normal `library(ggplot2); library(here);...` way of
## loading R packages.
pacman::p_load(ggplot2, here, HLMdiag, Ecdat, readr, ggthemes, tidyr, 
               hrbrthemes, dplyr, skimr, RColorBrewer, patchwork, ggpol, magrittr)
#p_load()
```


## A) Data:

```{r Load data, message=FALSE}
# Load `ggplot2` built in Diamonds dataset
diamonds <- diamonds

# Load Bundestag data
bundestag_party_seats <- read_csv(here("data/bundestag_party_seats_by_year.csv"))
  # Pivotted Bundestag data
bundestag_election_seats <- read_csv(here("data/bundestag.csv"))

#jfk2020 <- read_csv(here("data/jfk flights 2020.csv"))
```

I will be using two sets of data. The first the `diamonds` data set, from the `ggplot2` package; its variables denote different characteristics of individual diamonds, such as the carat, the size, the depth, the condition and the price of diamonds. The most evident analysis that we can do with this data is looking at how these different characteristics affect the price. The second data set I uploaded myself, and it gives the seat distribution for each party in the German Bundestag after every parliamentary election since 1949. There is one variable for the election year, and then one for each party's seat count after that election year. As you can see above, for these data I actually have two data frames - I had to transpose the data on excel for one of the last visualizations, so its the same data just pivoted. 


## Visualizations:

### Figure 1: Diamond Prices 

```{r fig2}
# Plot diamond prices with carat, adding color for the dimaond cut
ggplot(diamonds) +
  geom_point(aes(x = carat, y = price, color = cut), alpha = 0.45) +
  labs(title = "Variation in Diamond Prices", x = "Carat", y = "Price ($)", color = "Cut") +
  theme_economist() + 
  theme(text = element_text('Avenir Next Condensed'),
        axis.title.y = element_text(vjust = 2.2),
        plot.title = element_text(size = 18),
        legend.position = "right",
        legend.background = element_rect(color = 'black', linetype = 'solid'),
        legend.text = element_text(
          size = 10,
          face = 'italic'
        ))

```

- In the chart above, I plotted how diamond prices vary according to carat. We see a noticeable trend, where naturally the more carats the higher the price. Nevertheless, there seems to be a threshold after which all diamonds, regardless of carat, can be priced at the same amount. I also used color to indicate the quality of the cut of the diamond; unsurprisingly, we see that diamonds with poorer quality cuts are priced at lower ranges than diamonds of the same carat but of better cuts. 


### Figure 2: Party Seat Distribution in the Bundestag 

```{r Bundestag, message=FALSE, warning=FALSE}
#bundestag_party_seats %<>% 
 # mutate(greens_seats = ifelse(greens_seats == 0, NA, greens_seats)) %>% 
  #mutate(afd_seats = ifelse(afd_seats == 0, NA, afd_seats)) %>% 
  #mutate(other_seats = ifelse(other_seats == 0, NA, other_seats)) %>% 
  #mutate(linke_pds_seats = ifelse(linke_pds_seats == 0, NA, linke_pds_seats))

bundestag_2 <- gather(bundestag_party_seats[-c(1),], key = party, value = seats, 
                      c("cdu_csu_seats", "spd_seats", "fdp_seats", "greens_seats", 
                        "linke_pds_seats", "afd_seats", "other_seats")) 

ggplot(bundestag_2, aes(x = year, y = seats, group = party, colour = party, shape = party)) + 
  geom_line() +
  geom_point() +
   labs(title = "Historical Seat Distribution in the Bundestag", x = "Year", 
       y = "Number of Seats", color = "Party", shape = "Party",
       caption = "Source: https://www.bundeswahlleiter.de/en/bundeswahlleiter.html") +
  #scale_color_discrete() +
  scale_color_manual(breaks = c("cdu_csu_seats", "spd_seats", "fdp_seats", "greens_seats", 
                        "afd_seats", "linke_pds_seats", "other_seats"),
                     values=c('grey25', 'tomato3', 'gold2', 'springgreen4', 'skyblue1',
                              'plum', 'grey50'),
                     labels = c('CDU/CSU', 'SPD', 'FDP', 'Greens', 'Afd', 'Die Linke', 'Other')) +
  scale_shape_manual(breaks = c("cdu_csu_seats", "spd_seats", "fdp_seats", "greens_seats", 
                        "afd_seats", "linke_pds_seats", "other_seats"),
                     values=c(21, 24, 3, 22, 25, 10, 8),
                     labels = c('CDU/CSU', 'SPD', 'FDP', 'Greens', 'Afd', 'Die Linke', 'Other')) +
  scale_x_discrete(breaks = c("1949", "1957", "1965", "1972", "1980", "1987", "1994", "2002", "2009", "2017")) +
  theme_economist() +
  theme(text = element_text('Avenir Next Condensed'),
        plot.title = element_text(size = 18),
        plot.caption = element_text(face = "italic", vjust = -2.5, hjust = 1.4, size = 9),
        axis.title.y = element_text(vjust = 2.2),
        axis.title.x = element_text(vjust = -1.8),
        legend.position = "right",
        legend.background = element_rect(color = 'black', linetype = 'solid'),
        legend.box.background = element_rect(fill = "slategray2"),
        legend.key.size = unit(.5, "cm"),
        legend.title = element_text(size = 14),
        legend.text = element_text(
          size = 9,
          face = 'italic')
        )
```

- While this is not necessarily the fanciest line graph, it conveys quite well the general trends seen in the support for German parties. If we examine the trends chronologically, we can see the decline of the German right wing populist movement during the 50's: the number of CDU/CSU seats skyrockets, and this change seems to be primarily associated with the decrease in the seats of the 'Other' parties category (composed then of mostly of small right wing nationalist parties at the time). Until the 80s, the distribution in the Bundestag stays relatively stable. As the Greens and Die Linke (left-leaning and left parties) enter the parliament, the main center-left party SPD's seats don't seem to fall; in fact they rise, indicating a growth in support for left leaning politics (Perhaps an obvious development considering these changes took place after the German unification). After the 2000s, though, we see the Greens and Die Linke continue to grow progressively, eroding the SPD's share of seats. Additionally, we see the CDU/CSU retake its dominance (i.e., the Merkel years), but most significantly to German politics, and even European politics, we see the resurgence of right wing nationalist movements as AfD enters the Bundestag in 2017. Since the AfD gained seats in the national parliament, CDU/CSU seats have fallen, so we could infer that AfD benefited from taking some of CSU's voters. 


### Figures 3.A and 3.B: Composition of the Bundestag

```{r ggpol of Bundestag}
# A) Some cleaning for the graphs:
  # Rename column
bundestag_election_seats <- rename(bundestag_election_seats, "seats_2021" = "2021")
  # Rearrange rows:
bundestag_election_seats %<>% 
  arrange(factor(Party, levels = c("Other", "Afd", "CDU/CSU", "FDP", "Gr√ºne", "SPD", "Die Linke (PDS)")))


# B) Plot:
  # b.1) Plot graph of Bundestag after 2021 election
ggplot(bundestag_election_seats[-c(8:10),]) + 
  geom_parliament(aes(seats = seats_2021, fill = Party), color = "black") +
  labs(
    title = "German Bundestag After 2021 Election",
    caption = "Source: https://www.bundeswahlleiter.de/en/bundeswahlleiter.html") +
  scale_fill_manual(name = "Party", 
                    values = c("grey", "skyblue1", "grey25", "gold2",  
                               "springgreen4", "tomato3","plum"), 
                    labels = c("Other", "AfD", "CDU/CSU", "FDP", "Greens", "SPD", "Die Linke")) + 
  theme_void() +
  theme_economist() +
  theme(
    text = element_text('Avenir Next Condensed'),
    plot.title = element_text(face = 'bold', size = 25),
    #plot.margin = unit(c(1, 1, 1, 1), "cm"),
    plot.subtitle = element_text(size = 15, vjust = -0.6),
    legend.position = "right",
    legend.key.size = unit(c(0.55), "cm"),
    legend.title = element_text(size = 11),
    legend.text = element_text(size = 8),
    legend.box.background = element_rect(fill = "slategray2"), #lightsteelblue2 slategray2
    legend.box.margin = margin(5,5,5,5),
    plot.caption = element_text(face = 'italic', vjust = -0.5, size = 9, hjust = 1),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )

  # b.2) Plot graph of avg seat distribution in the Bundestag
ggplot(bundestag_election_seats[-c(8:10),]) + 
  geom_parliament(aes(seats = avg_seats, fill = Party), color = "black") +
  labs(
    title = "Average Seat Distribution in the Bundestag",
    subtitle = "(Since 1949)",
    caption = "Source: https://www.bundeswahlleiter.de/en/bundeswahlleiter.html") +
  scale_fill_manual(name = "Party", 
                    values = c("grey", "skyblue1", "grey25", "gold2",  
                               "springgreen4", "tomato3","plum"), 
                    labels = c("Other", "AfD", "CDU/CSU", "FDP", "Greens", "SPD", "Die Linke")) + #bundestag_election_seats$Party
  theme_void() +
  theme_economist() +
  theme(
    text = element_text('Avenir Next Condensed'),
    plot.title = element_text(face = 'bold', size = 25),
    #plot.margin = unit(c(1, 1, 1, 1), "cm"),
    plot.subtitle = element_text(size = 15, vjust = -0.6),
    legend.position = "right",
    legend.key.size = unit(c(0.55), "cm"),
    legend.title = element_text(size = 11),
    legend.text = element_text(size = 8),
    legend.box.background = element_rect(fill = "slategray2"), #lightsteelblue2 slategray2
    legend.box.margin = margin(5,5,5,5),
    plot.caption = element_text(face = 'italic', vjust = -0.5, size = 9, hjust = 1),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
  )

```
<p>
- The first graph shows the composition of the Bundestag after the 2021 election, and the second one, shows what the composition of the Bundestag looks like based on the average number of seats each party has had since the 1949. I think these graphs are not necessarily the most informative, since, for example, we cannot tell what the actual number of seats each party has, and we could use other simpler graphs to convey the information. However, I found this geom a little while ago and I personally think it looks really cool and wanted to show it. Moreover, by putting together the graph for the 2021 election and the seat averages, I think the viewer is able to get a general sense of which parties have dominated parliament and which parties have recently gained more support - specifically, we can see the CDU/CSU and SPD have dominated historically and other center as well as more radical parties have appeared in recent years. Ultimately, this is not the most sound graph, but I think it is visually appealing and I guess we don't always need to convey life changing insights in a graph. (I should add I am a bit of a politics geek so perhaps these graphs are not as interesting to others, but I digress)



